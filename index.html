<!DOCTYPE html>
<html lang="th">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>RISZY SHOP - Diagnostic Tool</title>
    <style>
        body { font-family: monospace; padding: 20px; background: #222; color: #fff; }
        .box { border: 1px solid #555; padding: 15px; margin-bottom: 20px; border-radius: 8px; background: #333; }
        h2 { color: #FFC72C; margin-top: 0; }
        button { padding: 10px 20px; cursor: pointer; background: #009933; color: white; border: none; font-size: 16px; border-radius: 4px; margin-right: 10px; }
        button:hover { background: #007722; }
        button.error { background: #cc0000; }
        input { padding: 8px; width: 60%; margin-bottom: 10px; border-radius: 4px; border: 1px solid #ccc; }
        .log { background: #000; padding: 10px; height: 150px; overflow-y: scroll; border: 1px solid #444; font-size: 12px; color: #0f0; margin-top: 10px; }
        .status { font-weight: bold; font-size: 18px; margin-bottom: 10px; }
    </style>
</head>
<body>

    <h1>üîß ‡πÄ‡∏Ñ‡∏£‡∏∑‡πà‡∏≠‡∏á‡∏°‡∏∑‡∏≠‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö‡∏õ‡∏±‡∏ç‡∏´‡∏≤ (Diagnostic)</h1>
    <p>‡πÉ‡∏ä‡πâ‡πÇ‡∏Ñ‡πâ‡∏î‡∏ô‡∏µ‡πâ‡πÄ‡∏ä‡πá‡∏Ñ‡∏ß‡πà‡∏≤ Firebase ‡πÄ‡∏ä‡∏∑‡πà‡∏≠‡∏°‡∏ï‡πà‡∏≠‡πÑ‡∏î‡πâ‡∏à‡∏£‡∏¥‡∏á‡∏´‡∏£‡∏∑‡∏≠‡πÑ‡∏°‡πà</p>

    <!-- 1. CHECK DATABASE -->
    <div class="box">
        <h2>1. ‡∏ó‡∏î‡∏™‡∏≠‡∏ö‡∏ê‡∏≤‡∏ô‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏• (Database Rule)</h2>
        <p>‡∏ñ‡πâ‡∏≤‡∏Å‡∏î‡∏õ‡∏∏‡πà‡∏°‡πÅ‡∏•‡πâ‡∏ß‡∏Ç‡∏∂‡πâ‡∏ô Error ‡∏™‡∏µ‡πÅ‡∏î‡∏á ‡πÅ‡∏™‡∏î‡∏á‡∏ß‡πà‡∏≤‡∏Ñ‡∏∏‡∏ì‡∏¢‡∏±‡∏á‡πÑ‡∏°‡πà‡πÑ‡∏î‡πâ‡πÅ‡∏Å‡πâ Rules ‡πÄ‡∏õ‡πá‡∏ô true</p>
        <div id="dbStatus" class="status" style="color: yellow;">‡∏£‡∏≠‡∏Å‡∏≤‡∏£‡∏ó‡∏î‡∏™‡∏≠‡∏ö...</div>
        <button onclick="testDatabaseWrite()">‡∏ó‡∏î‡∏™‡∏≠‡∏ö‡∏Å‡∏≤‡∏£‡πÄ‡∏Ç‡∏µ‡∏¢‡∏ô‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•</button>
    </div>

    <!-- 2. CHECK AUTH REGISTER -->
    <div class="box">
        <h2>2. ‡∏ó‡∏î‡∏™‡∏≠‡∏ö‡∏™‡∏°‡∏±‡∏Ñ‡∏£‡∏™‡∏°‡∏≤‡∏ä‡∏¥‡∏Å (Auth)</h2>
        <p>‡∏•‡∏≠‡∏á‡∏™‡∏°‡∏±‡∏Ñ‡∏£‡∏î‡∏π‡∏ß‡πà‡∏≤‡∏ú‡πà‡∏≤‡∏ô‡πÑ‡∏´‡∏° (‡∏ñ‡πâ‡∏≤‡πÑ‡∏°‡πà‡∏ú‡πà‡∏≤‡∏ô ‡πÅ‡∏™‡∏î‡∏á‡∏ß‡πà‡∏≤‡πÑ‡∏°‡πà‡πÑ‡∏î‡πâ‡πÄ‡∏õ‡∏¥‡∏î Email/Pass ‡πÉ‡∏ô Console)</p>
        <input type="email" id="testEmail" placeholder="test@email.com" value="test1@test.com">
        <input type="password" id="testPass" placeholder="password" value="123456">
        <br>
        <button onclick="testRegister()">‡∏ó‡∏î‡∏™‡∏≠‡∏ö‡∏™‡∏°‡∏±‡∏Ñ‡∏£‡∏™‡∏°‡∏≤‡∏ä‡∏¥‡∏Å</button>
    </div>

    <!-- 3. CHECK LOGIN -->
    <div class="box">
        <h2>3. ‡∏ó‡∏î‡∏™‡∏≠‡∏ö‡∏•‡πá‡∏≠‡∏Å‡∏≠‡∏¥‡∏ô (Auth)</h2>
        <input type="email" id="loginEmail" placeholder="test@email.com" value="test1@test.com">
        <input type="password" id="loginPass" placeholder="password" value="123456">
        <br>
        <button onclick="testLogin()">‡∏ó‡∏î‡∏™‡∏≠‡∏ö Login</button>
    </div>

    <div class="box">
        <h2>Log ‡∏Å‡∏≤‡∏£‡∏ó‡∏≥‡∏á‡∏≤‡∏ô</h2>
        <div id="consoleLog" class="log"></div>
    </div>

    <script type="module">
        import { initializeApp } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-app.js";
        import { getAuth, createUserWithEmailAndPassword, signInWithEmailAndPassword } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-auth.js";
        import { getDatabase, ref, set } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-database.js";

        // Config ‡∏Ç‡∏≠‡∏á‡∏Ñ‡∏∏‡∏ì
        const firebaseConfig = {
            apiKey: "AIzaSyAHAkBhypqyJuuL22tLrFKN7ZqdEsqGDTk",
            authDomain: "rsdm-9ca2a.firebaseapp.com",
            projectId: "rsdm-9ca2a",
            storageBucket: "rsdm-9ca2a.firebasestorage.app",
            messagingSenderId: "299212700124",
            appId: "1:299212700124:web:730160dae6bb1b09cbb719",
            measurementId: "G-CMX9GKW7FF"
        };

        // Initialize
        const app = initializeApp(firebaseConfig);
        const auth = getAuth(app);
        const db = getDatabase(app);

        // Helper Log
        function log(msg, type='info') {
            const logDiv = document.getElementById('consoleLog');
            const color = type === 'error' ? 'red' : '#0f0';
            logDiv.innerHTML += `<div style="color:${color};">> ${msg}</div>`;
            logDiv.scrollTop = logDiv.scrollHeight;
            console.log(msg);
        }

        // 1. TEST DATABASE
        window.testDatabaseWrite = async () => {
            log("‡∏Å‡∏≥‡∏•‡∏±‡∏á‡∏ó‡∏î‡∏™‡∏≠‡∏ö‡πÄ‡∏Ç‡∏µ‡∏¢‡∏ô‡∏ê‡∏≤‡∏ô‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•...");
            try {
                await set(ref(db, 'test_connection'), {
                    message: "Connected!",
                    timestamp: Date.now()
                });
                document.getElementById('dbStatus').innerText = "‚úÖ ‡πÄ‡∏ä‡∏∑‡πà‡∏≠‡∏°‡∏ï‡πà‡∏≠‡∏ê‡∏≤‡∏ô‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à (Rules ‡∏ñ‡∏π‡∏Å‡∏ï‡πâ‡∏≠‡∏á)";
                document.getElementById('dbStatus').style.color = "#0f0";
                log("‡πÄ‡∏Ç‡∏µ‡∏¢‡∏ô‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏•‡∏á 'test_connection' ‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à!");
            } catch (error) {
                document.getElementById('dbStatus').innerText = "‚ùå ‡πÄ‡∏ä‡∏∑‡πà‡∏≠‡∏°‡∏ï‡πà‡∏≠‡∏•‡πâ‡∏°‡πÄ‡∏´‡∏•‡∏ß (Permission Denied)";
                document.getElementById('dbStatus').style.color = "red";
                log("Error: " + error.message, 'error');
                log("‡∏Ñ‡∏≥‡πÅ‡∏ô‡∏∞‡∏ô‡∏≥: ‡πÑ‡∏õ‡∏ó‡∏µ‡πà Firebase Console > Realtime Database > Rules ‡πÅ‡∏•‡πâ‡∏ß‡πÅ‡∏Å‡πâ .write ‡πÄ‡∏õ‡πá‡∏ô true");
            }
        };

        // 2. TEST REGISTER
        window.testRegister = async () => {
            const email = document.getElementById('testEmail').value;
            const pass = document.getElementById('testPass').value;
            log(`‡∏Å‡∏≥‡∏•‡∏±‡∏á‡∏ó‡∏î‡∏™‡∏≠‡∏ö‡∏™‡∏°‡∏±‡∏Ñ‡∏£‡∏™‡∏°‡∏≤‡∏ä‡∏¥‡∏Å: ${email}...`);
            
            try {
                const userCredential = await createUserWithEmailAndPassword(auth, email, pass);
                log("‚úÖ ‡∏™‡∏°‡∏±‡∏Ñ‡∏£‡∏™‡∏°‡∏≤‡∏ä‡∏¥‡∏Å‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à! UID: " + userCredential.user.uid);
                alert("‡∏™‡∏°‡∏±‡∏Ñ‡∏£‡∏™‡∏°‡∏≤‡∏ä‡∏¥‡∏Å‡πÑ‡∏î‡πâ‡∏õ‡∏Å‡∏ï‡∏¥‡∏Ñ‡∏£‡∏±‡∏ö!");
            } catch (error) {
                log("‚ùå ‡∏™‡∏°‡∏±‡∏Ñ‡∏£‡πÑ‡∏°‡πà‡∏ú‡πà‡∏≤‡∏ô: " + error.code, 'error');
                if (error.code === 'auth/email-already-in-use') {
                    log("‡∏≠‡∏µ‡πÄ‡∏°‡∏•‡∏ô‡∏µ‡πâ‡∏°‡∏µ‡∏Ñ‡∏ô‡πÉ‡∏ä‡πâ‡πÅ‡∏•‡πâ‡∏ß (‡πÅ‡∏™‡∏î‡∏á‡∏ß‡πà‡∏≤‡∏£‡∏∞‡∏ö‡∏ö‡πÄ‡∏ä‡∏∑‡πà‡∏≠‡∏°‡∏ï‡πà‡∏≠‡πÑ‡∏î‡πâ‡∏õ‡∏Å‡∏ï‡∏¥ ‡πÅ‡∏ï‡πà‡∏≠‡∏µ‡πÄ‡∏°‡∏•‡∏ã‡πâ‡∏≥)");
                } else if (error.code === 'auth/operation-not-allowed') {
                    log("‡∏™‡∏≥‡∏Ñ‡∏±‡∏ç: ‡∏Ñ‡∏∏‡∏ì‡∏¢‡∏±‡∏á‡πÑ‡∏°‡πà‡πÑ‡∏î‡πâ‡πÄ‡∏õ‡∏¥‡∏î Email/Password ‡πÉ‡∏ô Firebase Console");
                    alert("‡πÑ‡∏õ‡∏ó‡∏µ‡πà Authentication > Sign-in method ‡πÅ‡∏•‡πâ‡∏ß‡πÄ‡∏õ‡∏¥‡∏î Email/Password ‡∏Å‡πà‡∏≠‡∏ô‡∏Ñ‡∏£‡∏±‡∏ö");
                } else {
                    log(error.message, 'error');
                }
            }
        };

        // 3. TEST LOGIN
        window.testLogin = async () => {
            const email = document.getElementById('loginEmail').value;
            const pass = document.getElementById('loginPass').value;
            log(`‡∏Å‡∏≥‡∏•‡∏±‡∏á‡∏ó‡∏î‡∏™‡∏≠‡∏ö‡∏•‡πá‡∏≠‡∏Å‡∏≠‡∏¥‡∏ô: ${email}...`);

            try {
                const userCredential = await signInWithEmailAndPassword(auth, email, pass);
                log("‚úÖ ‡∏•‡πá‡∏≠‡∏Å‡∏≠‡∏¥‡∏ô‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à! ‡∏¢‡∏¥‡∏ô‡∏î‡∏µ‡∏ï‡πâ‡∏≠‡∏ô‡∏£‡∏±‡∏ö: " + userCredential.user.email);
                alert("‡∏•‡πá‡∏≠‡∏Å‡∏≠‡∏¥‡∏ô‡πÑ‡∏î‡πâ‡∏õ‡∏Å‡∏ï‡∏¥‡∏Ñ‡∏£‡∏±‡∏ö!");
            } catch (error) {
                log("‚ùå ‡∏•‡πá‡∏≠‡∏Å‡∏≠‡∏¥‡∏ô‡πÑ‡∏°‡πà‡∏ú‡πà‡∏≤‡∏ô: " + error.code, 'error');
                if (error.code === 'auth/invalid-credential' || error.code === 'auth/user-not-found') {
                    log("‡∏≠‡∏µ‡πÄ‡∏°‡∏•‡∏´‡∏£‡∏∑‡∏≠‡∏£‡∏´‡∏±‡∏™‡∏ú‡πà‡∏≤‡∏ô‡∏ú‡∏¥‡∏î");
                } else {
                    log(error.message, 'error');
                }
            }
        }
    </script>
</body>
</html>
