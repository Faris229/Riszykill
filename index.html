<!DOCTYPE html>
<html lang="th">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>FF Arena - Live Display</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://fonts.googleapis.com/css2?family=Kanit:wght@300;400;600;800&family=Teko:wght@600&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/animate.css/4.1.1/animate.min.css"/>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    
    <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-firestore-compat.js"></script>

    <style>
        body { font-family: 'Kanit', sans-serif; background-color: #f8fafc; overflow: hidden; touch-action: none; }
        .font-condensed { font-family: 'Teko', sans-serif; }
        
        /* Glass Card */
        .glass-card {
            background: rgba(255, 255, 255, 0.9);
            backdrop-filter: blur(10px);
            border: 1px solid #e2e8f0;
            box-shadow: 0 10px 30px -5px rgba(0, 0, 0, 0.1);
        }

        /* Responsive Layout Tweaks */
        @media (max-width: 768px) {
            .vs-icon { font-size: 3rem !important; margin: 10px 0 !important; }
            .card-title { font-size: 0.7rem !important; padding: 4px 12px !important; top: -12px !important; }
            .player-name { font-size: 2rem !important; }
        }

        /* Animations */
        @keyframes float { 0%,100% { transform: translateY(0px); } 50% { transform: translateY(-8px); } }
        .floating { animation: float 5s ease-in-out infinite; }
        
        .hide-scroll::-webkit-scrollbar { display: none; }
        
        /* Ticker */
        .ticker-wrap { position: fixed; top: 0; width: 100%; height: 2.5rem; background: #2563eb; color: white; z-index: 50; display: flex; }
        .ticker { display: inline-block; white-space: nowrap; animation: ticker 20s linear infinite; padding-left: 100%; align-self: center; }
        @keyframes ticker { 0% { transform: translate3d(0, 0, 0); } 100% { transform: translate3d(-100%, 0, 0); } }
    </style>
</head>
<body class="h-screen flex flex-col relative text-slate-800">

    <div id="ticker-area" class="ticker-wrap hidden">
        <div class="bg-blue-800 px-4 flex items-center font-bold text-xs uppercase z-10"><i class="fa-solid fa-bullhorn mr-2"></i> ประกาศ</div>
        <div id="ticker-text" class="ticker text-sm font-medium">...</div>
    </div>

    <main class="flex-1 flex flex-col md:flex-row items-center justify-center p-4 md:p-10 gap-4 md:gap-12 w-full max-w-7xl mx-auto pt-12 md:pt-0">
        
        <div class="w-full md:flex-1 max-w-md relative floating" style="animation-delay: 0s;">
            <div class="glass-card rounded-3xl p-6 md:p-8 text-center border-t-8 border-yellow-400 relative">
                <div class="absolute -top-4 left-1/2 transform -translate-x-1/2 card-title bg-gradient-to-r from-yellow-400 to-orange-500 text-white px-6 py-1 rounded-full shadow-lg text-xs md:text-sm font-bold tracking-widest uppercase">
                    <span id="label-king">KING</span>
                </div>
                
                <div class="mt-4 mb-2 flex items-center justify-center h-16 md:h-24">
                    <h2 id="king-name" class="player-name text-4xl md:text-5xl font-bold truncate">Loading...</h2>
                </div>

                <div class="bg-yellow-50 rounded-xl p-2 md:p-3 flex justify-center items-center gap-3 border border-yellow-100">
                    <i class="fa-solid fa-trophy text-yellow-600 text-xl"></i>
                    <div class="text-left leading-none">
                        <div class="text-[10px] font-bold text-yellow-600 uppercase">Win Streak</div>
                        <div id="king-wins" class="text-2xl font-condensed font-bold">0</div>
                    </div>
                </div>
            </div>
        </div>

        <div class="text-center z-10">
            <span class="vs-icon text-6xl md:text-8xl font-black italic text-slate-300 drop-shadow-sm animate__animated animate__pulse animate__infinite">VS</span>
        </div>

        <div class="w-full md:flex-1 max-w-md relative floating" style="animation-delay: 2s;">
            <div class="glass-card rounded-3xl p-6 md:p-8 text-center border-t-8 border-blue-500 relative">
                <div class="absolute -top-4 left-1/2 transform -translate-x-1/2 card-title bg-gradient-to-r from-blue-500 to-indigo-600 text-white px-6 py-1 rounded-full shadow-lg text-xs md:text-sm font-bold tracking-widest uppercase">
                    <span id="label-chal">CHALLENGER</span>
                </div>
                
                <div class="mt-4 mb-2 flex items-center justify-center h-16 md:h-24">
                    <h2 id="chal-name" class="player-name text-4xl md:text-5xl font-bold truncate">Loading...</h2>
                </div>

                <div class="bg-blue-50 rounded-xl p-2 md:p-3 flex justify-center items-center gap-3 border border-blue-100">
                    <i class="fa-solid fa-sack-dollar text-blue-600 text-xl"></i>
                    <div class="text-left leading-none">
                        <div class="text-[10px] font-bold text-blue-600 uppercase">Donation</div>
                        <div id="chal-donate" class="text-2xl font-condensed font-bold">0</div>
                    </div>
                </div>
            </div>
        </div>

    </main>

    <div class="bg-white/90 backdrop-blur border-t border-slate-200 h-24 md:h-32 fixed bottom-0 left-0 w-full z-20 flex flex-col shadow-lg">
        <div class="flex justify-between items-center px-4 py-1.5 border-b border-slate-100 bg-slate-50/50">
            <span class="text-[10px] md:text-xs font-bold text-slate-500 uppercase tracking-wider"><i class="fa-solid fa-list-ol mr-1"></i> Waiting Queue</span>
            <span class="text-[10px] md:text-xs font-bold text-slate-400">Total: <span id="q-total" class="text-slate-800">0</span></span>
        </div>
        <div id="queue-container" class="flex-1 flex items-center gap-3 px-4 overflow-x-auto hide-scroll">
            </div>
    </div>

    <script>
        // Config
        const firebaseConfig = {
            apiKey: "AIzaSyBt4Hsmdf6BITdtYvysSMnkmfwFX_4Pm8s",
            authDomain: "hubfu-c4296.firebaseapp.com",
            projectId: "hubfu-c4296",
            storageBucket: "hubfu-c4296.firebasestorage.app",
            messagingSenderId: "864674622740",
            appId: "1:864674622740:web:3131798892e0e63e12a601"
        };
        if (!firebase.apps.length) firebase.initializeApp(firebaseConfig);
        const db = firebase.firestore();

        // 1. Listen Main State
        db.collection('arena_system').doc('main_state').onSnapshot((doc) => {
            if (doc.exists) {
                const d = doc.data();
                updateText('king-name', d.kingName || "ว่าง");
                updateText('king-wins', d.kingWins || 0);
                document.getElementById('label-king').innerText = d.kingTitle || "KING";

                updateText('chal-name', d.chalName || "ว่าง");
                updateText('chal-donate', `฿${d.chalDonate || 0}`);
                document.getElementById('label-chal').innerText = d.chalTitle || "CHALLENGER";

                const ticker = document.getElementById('ticker-area');
                if (d.announcementActive) {
                    ticker.classList.remove('hidden');
                    document.getElementById('ticker-text').innerText = d.announcementText || "";
                } else {
                    ticker.classList.add('hidden');
                }
            }
        });

        // 2. Listen Queue
        db.collection('arena_system').doc('main_state').collection('queue')
            .orderBy('donate', 'desc').orderBy('timestamp', 'asc').onSnapshot((snap) => {
                const con = document.getElementById('queue-container');
                document.getElementById('q-total').innerText = snap.size;
                con.innerHTML = '';
                
                if (snap.empty) {
                    con.innerHTML = '<span class="text-slate-300 w-full text-center text-xs">Waiting for players...</span>';
                    return;
                }

                snap.forEach((doc, i) => {
                    const d = doc.data();
                    const isTop = i === 0;
                    const cardClass = isTop ? 'bg-yellow-50 border-yellow-300' : 'bg-white border-slate-200 opacity-70';
                    const html = `
                        <div class="min-w-[140px] md:min-w-[160px] h-14 md:h-16 ${cardClass} border rounded-xl px-3 flex flex-col justify-center animate__animated animate__fadeInRight" style="animation-delay: ${i*0.1}s">
                            <div class="flex justify-between items-center mb-0.5">
                                <span class="text-[10px] font-bold text-slate-400">#${i+1}</span>
                                <span class="text-[10px] font-bold text-green-500">฿${d.donate}</span>
                            </div>
                            <div class="font-bold text-slate-700 truncate text-sm">${d.name}</div>
                        </div>
                    `;
                    con.insertAdjacentHTML('beforeend', html);
                });
            });

        function updateText(id, val) {
            const el = document.getElementById(id);
            if (el.innerText != val) {
                el.classList.remove('animate__fadeIn');
                void el.offsetWidth;
                el.innerText = val;
                el.classList.add('animate__animated', 'animate__fadeIn');
            }
        }
    </script>
</body>
</html>
