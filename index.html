<!DOCTYPE html>
<html lang="th">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Wallet Pro | Banking</title>
    
    <link href="https://fonts.googleapis.com/css2?family=Prompt:wght@300;400;500;600;700&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <link href="https://cdn.jsdelivr.net/npm/sweetalert2@11/dist/sweetalert2.min.css" rel="stylesheet">

    <style>
        :root {
            --primary: #2563eb; /* Royal Blue */
            --primary-dark: #1e40af;
            --accent: #3b82f6;
            --bg-body: #f3f4f6;
            --card-shadow: 0 10px 25px -5px rgba(0, 0, 0, 0.1), 0 8px 10px -6px rgba(0, 0, 0, 0.1);
        }

        * { box-sizing: border-box; -webkit-tap-highlight-color: transparent; outline: none; }
        body { font-family: 'Prompt', sans-serif; background: var(--bg-body); margin: 0; padding-bottom: 80px; color: #1f2937; }
        .hidden { display: none !important; }
        .container { max-width: 480px; margin: 0 auto; padding: 20px; }

        /* Login */
        #auth-screen { position: fixed; inset: 0; background: white; z-index: 3000; display: flex; flex-direction: column; justify-content: center; padding: 30px; }
        .auth-header { margin-bottom: 30px; text-align: center; }
        .auth-icon { font-size: 3rem; color: var(--primary); margin-bottom: 15px; }
        input { width: 100%; padding: 16px; border: 2px solid #e5e7eb; border-radius: 12px; margin-bottom: 12px; font-size: 1rem; font-family: inherit; transition: 0.3s; background: #f9fafb; }
        input:focus { border-color: var(--primary); background: white; }

        /* Buttons */
        .btn { width: 100%; padding: 14px; border-radius: 12px; border: none; font-weight: 600; font-size: 1rem; cursor: pointer; transition: 0.2s; display: flex; justify-content: center; align-items: center; gap: 8px; }
        .btn-primary { background: var(--primary); color: white; box-shadow: 0 4px 6px rgba(37, 99, 235, 0.2); }
        .btn-ghost { background: transparent; color: #6b7280; }
        .btn:active { transform: scale(0.98); }

        /* App Header */
        .app-header { display: flex; justify-content: space-between; align-items: center; margin-bottom: 20px; }
        .user-mini { display: flex; align-items: center; gap: 10px; }
        .avatar { width: 45px; height: 45px; border-radius: 50%; object-fit: cover; border: 2px solid white; box-shadow: 0 2px 4px rgba(0,0,0,0.1); }
        .settings-btn { width: 40px; height: 40px; border-radius: 50%; background: white; border: none; color: #4b5563; box-shadow: 0 2px 4px rgba(0,0,0,0.05); cursor: pointer; }

        /* Wallet Card */
        .wallet-card {
            background: linear-gradient(135deg, #2563eb, #4f46e5);
            color: white; padding: 25px; border-radius: 24px;
            box-shadow: var(--card-shadow); margin-bottom: 25px; position: relative; overflow: hidden;
        }
        .balance-label { font-size: 0.9rem; opacity: 0.9; }
        .balance-val { font-size: 2.5rem; font-weight: 800; margin: 5px 0; letter-spacing: -1px; }

        /* Menu Grid */
        .menu-grid { display: grid; grid-template-columns: repeat(4, 1fr); gap: 10px; margin-bottom: 30px; }
        .menu-item { background: white; border-radius: 16px; padding: 15px 5px; text-align: center; cursor: pointer; transition: 0.2s; box-shadow: 0 2px 5px rgba(0,0,0,0.03); }
        .menu-item:active { transform: scale(0.95); }
        .menu-icon { font-size: 1.5rem; margin-bottom: 5px; display: block; }
        .menu-label { font-size: 0.75rem; font-weight: 600; color: #4b5563; }

        /* Bank Info Card */
        .bank-card { background: white; padding: 20px; border-radius: 16px; box-shadow: 0 2px 10px rgba(0,0,0,0.03); margin-bottom: 25px; display: flex; align-items: center; justify-content: space-between; border-left: 5px solid #10b981; }
        .bank-details { font-size: 0.9rem; }
        .bank-details b { display: block; font-size: 1rem; color: #111827; }

        /* History */
        .tab-group { display: flex; gap: 10px; margin-bottom: 15px; overflow-x: auto; padding-bottom: 5px; }
        .tab-btn { padding: 6px 16px; border-radius: 20px; border: 1px solid #e5e7eb; background: white; color: #6b7280; font-size: 0.85rem; font-weight: 500; cursor: pointer; white-space: nowrap; }
        .tab-btn.active { background: var(--primary); color: white; border-color: var(--primary); }

        .tx-list { background: white; border-radius: 20px; padding: 10px; box-shadow: var(--card-shadow); min-height: 200px; }
        .tx-item { display: flex; justify-content: space-between; align-items: center; padding: 15px; border-bottom: 1px solid #f3f4f6; }
        .tx-item:last-child { border-bottom: none; }
        .tx-icon-box { width: 40px; height: 40px; border-radius: 12px; display: flex; justify-content: center; align-items: center; font-size: 1.2rem; margin-right: 12px; }
        .st-badge { font-size: 0.7rem; padding: 2px 8px; border-radius: 6px; font-weight: 600; display: inline-block; margin-top: 4px; }
        .st-pending { background: #fff7ed; color: #c2410c; }
        .st-approved { background: #ecfdf5; color: #047857; }
        .st-rejected { background: #fef2f2; color: #b91c1c; }
    </style>
</head>
<body>

    <div id="auth-screen">
        <div class="auth-header">
            <div class="auth-icon"><i class="fa-solid fa-vault"></i></div>
            <h2>Pro Wallet</h2>
            <p style="color:#6b7280;">‡πÄ‡∏Ç‡πâ‡∏≤‡∏™‡∏π‡πà‡∏£‡∏∞‡∏ö‡∏ö‡∏à‡∏±‡∏î‡∏Å‡∏≤‡∏£‡πÄ‡∏á‡∏¥‡∏ô‡∏Ç‡∏≠‡∏á‡∏Ñ‡∏∏‡∏ì</p>
        </div>
        <input type="text" id="auth-input" placeholder="Username / Email">
        <input type="password" id="auth-pass" placeholder="Password">
        <button class="btn btn-primary" onclick="authAction('login')">‡πÄ‡∏Ç‡πâ‡∏≤‡∏™‡∏π‡πà‡∏£‡∏∞‡∏ö‡∏ö</button>
        <button class="btn btn-ghost" onclick="authAction('signup')" style="margin-top:10px;">‡∏™‡∏°‡∏±‡∏Ñ‡∏£‡∏™‡∏°‡∏≤‡∏ä‡∏¥‡∏Å</button>
    </div>

    <div id="app-container" class="container hidden">
        
        <div class="app-header">
            <div class="user-mini">
                <img src="" id="user-avatar" class="avatar">
                <div>
                    <div style="font-size:0.75rem; color:#6b7280;">‡∏™‡∏ß‡∏±‡∏™‡∏î‡∏µ‡∏ï‡∏≠‡∏ô‡πÄ‡∏ä‡πâ‡∏≤</div>
                    <div style="font-weight:700;" id="user-name">User</div>
                </div>
            </div>
            <button class="settings-btn" onclick="openSettings()"><i class="fa-solid fa-gear"></i></button>
        </div>

        <div class="wallet-card">
            <div class="balance-label">‡∏¢‡∏≠‡∏î‡πÄ‡∏á‡∏¥‡∏ô‡∏Ñ‡∏á‡πÄ‡∏´‡∏•‡∏∑‡∏≠</div>
            <div class="balance-val"><span id="user-balance">0.00</span> ‡∏ø</div>
            <div style="font-size:0.8rem; opacity:0.8;"><i class="fa-solid fa-lock"></i> Secured by Firebase</div>
        </div>

        <div id="bank-info-box" class="bank-card hidden" onclick="editBankInfo()">
            <div class="bank-details">
                <span style="color:#6b7280; font-size:0.8rem;">‡∏ö‡∏±‡∏ç‡∏ä‡∏µ‡∏£‡∏±‡∏ö‡πÄ‡∏á‡∏¥‡∏ô‡∏Ç‡∏≠‡∏á‡∏Ñ‡∏∏‡∏ì</span>
                <b id="my-bank-name">‡∏ò‡∏ô‡∏≤‡∏Ñ‡∏≤‡∏£...</b>
                <span id="my-bank-no">xxx-x-xxxxx-x</span>
            </div>
            <i class="fa-solid fa-pen-to-square" style="color:#9ca3af;"></i>
        </div>
        <div id="no-bank-box" class="menu-item" style="margin-bottom:20px; border:1px dashed #ccc; color:var(--primary);" onclick="editBankInfo()">
            + ‡πÄ‡∏û‡∏¥‡πà‡∏°‡∏ö‡∏±‡∏ç‡∏ä‡∏µ‡∏ò‡∏ô‡∏≤‡∏Ñ‡∏≤‡∏£ (‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö‡∏ñ‡∏≠‡∏ô‡πÄ‡∏á‡∏¥‡∏ô)
        </div>

        <div class="menu-grid">
            <div class="menu-item" onclick="openDeposit()">
                <div class="menu-icon" style="color:#10b981;"><i class="fa-solid fa-circle-down"></i></div>
                <div class="menu-label">‡πÄ‡∏ï‡∏¥‡∏°‡πÄ‡∏á‡∏¥‡∏ô</div>
            </div>
            <div class="menu-item" onclick="openWithdraw()">
                <div class="menu-icon" style="color:#ef4444;"><i class="fa-solid fa-circle-up"></i></div>
                <div class="menu-label">‡∏ñ‡∏≠‡∏ô‡πÄ‡∏á‡∏¥‡∏ô</div>
            </div>
            <div class="menu-item" onclick="openSupport()">
                <div class="menu-icon" style="color:#f59e0b;"><i class="fa-solid fa-headset"></i></div>
                <div class="menu-label">‡∏ä‡πà‡∏ß‡∏¢‡πÄ‡∏´‡∏•‡∏∑‡∏≠</div>
            </div>
            <div class="menu-item" onclick="openHistory()">
                <div class="menu-icon" style="color:#6366f1;"><i class="fa-solid fa-clock-rotate-left"></i></div>
                <div class="menu-label">‡∏õ‡∏£‡∏∞‡∏ß‡∏±‡∏ï‡∏¥</div>
            </div>
        </div>

        <div style="display:flex; justify-content:space-between; align-items:center; margin-bottom:15px;">
            <h3 style="margin:0;">‡∏ò‡∏∏‡∏£‡∏Å‡∏£‡∏£‡∏°‡∏•‡πà‡∏≤‡∏™‡∏∏‡∏î</h3>
            <div class="tab-group" style="margin:0;">
                <div class="tab-btn active" onclick="filterTx('all', this)">‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î</div>
                <div class="tab-btn" onclick="filterTx('deposit', this)">‡∏ù‡∏≤‡∏Å</div>
                <div class="tab-btn" onclick="filterTx('withdraw', this)">‡∏ñ‡∏≠‡∏ô</div>
            </div>
        </div>
        
        <div id="tx-list" class="tx-list">
            <div style="text-align:center; padding:30px; color:#9ca3af;">‡∏Å‡∏≥‡∏•‡∏±‡∏á‡πÇ‡∏´‡∏•‡∏î...</div>
        </div>
    </div>

    <script src="https://www.gstatic.com/firebasejs/9.6.10/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.6.10/firebase-auth-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.6.10/firebase-firestore-compat.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/sweetalert2@11"></script>

    <script>
        // üî¥ ‡∏ï‡∏±‡πâ‡∏á‡∏Ñ‡πà‡∏≤
        const FB_LINK = "https://m.me/yourpage"; 
        const ADMIN_BANK_INFO = "‡∏ò.‡∏Å‡∏™‡∏¥‡∏Å‡∏£‡πÑ‡∏ó‡∏¢ 012-345-6789\n‡∏ä‡∏∑‡πà‡∏≠‡∏ö‡∏±‡∏ç‡∏ä‡∏µ: ‡πÅ‡∏≠‡∏î‡∏°‡∏¥‡∏ô ‡∏ß‡∏≠‡∏•‡πÄ‡∏•‡πá‡∏ï";

        const firebaseConfig = {
            apiKey: "AIzaSyA2NTzJKFK3GtULDl-l2EvEH3VamDh-VZI",
            authDomain: "chat-27f96.firebaseapp.com",
            projectId: "chat-27f96",
            storageBucket: "chat-27f96.firebasestorage.app",
            messagingSenderId: "336686938010",
            appId: "1:336686938010:web:9ea0e0ddd8d93e8358ec23"
        };
        if(!firebase.apps.length) firebase.initializeApp(firebaseConfig);
        const auth = firebase.auth();
        const db = firebase.firestore();

        let currentUser = null;
        let currentData = {};
        let allTx = [];

        auth.onAuthStateChanged(user => {
            if(user) {
                currentUser = user;
                document.getElementById('auth-screen').classList.add('hidden');
                document.getElementById('app-container').classList.remove('hidden');
                initData();
            } else {
                document.getElementById('auth-screen').classList.remove('hidden');
                document.getElementById('app-container').classList.add('hidden');
            }
        });

        // --- AUTH ---
        async function authAction(type) {
            const inp = document.getElementById('auth-input').value.trim();
            const pass = document.getElementById('auth-pass').value;
            if(!inp || !pass) return Swal.fire('‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡πÑ‡∏°‡πà‡∏Ñ‡∏£‡∏ö','','warning');

            try {
                let email = inp;
                if(!inp.includes('@')) {
                    const snap = await db.collection('users').where('username','==',inp).get();
                    if(snap.empty) throw new Error('‡πÑ‡∏°‡πà‡∏û‡∏ö‡∏ä‡∏∑‡πà‡∏≠‡∏ú‡∏π‡πâ‡πÉ‡∏ä‡πâ‡∏ô‡∏µ‡πâ');
                    email = snap.docs[0].data().email;
                }

                if(type === 'login') {
                    await auth.signInWithEmailAndPassword(email, pass);
                } else {
                    const c = await auth.createUserWithEmailAndPassword(email, pass);
                    await db.collection('users').doc(c.user.uid).set({
                        email: email, username: inp.split('@')[0], balance: 0.00,
                        photoURL: `https://ui-avatars.com/api/?name=${inp}&background=random`,
                        bankName: '', bankNo: '', bankAccName: '', createdAt: new Date()
                    });
                    Swal.fire('‡∏™‡∏°‡∏±‡∏Ñ‡∏£‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à','‡∏¢‡∏¥‡∏ô‡∏î‡∏µ‡∏ï‡πâ‡∏≠‡∏ô‡∏£‡∏±‡∏ö‡∏™‡∏π‡πà Pro Wallet','success');
                }
            } catch(e) { Swal.fire('Error', e.message, 'error'); }
        }

        // --- DATA LOADING ---
        function initData() {
            // User Data
            db.collection('users').doc(currentUser.uid).onSnapshot(doc => {
                currentData = doc.data();
                document.getElementById('user-balance').innerText = (currentData.balance||0).toLocaleString(undefined, {minimumFractionDigits:2});
                document.getElementById('user-name').innerText = currentData.username;
                document.getElementById('user-avatar').src = currentData.photoURL;

                // Check Bank Info
                if(currentData.bankName && currentData.bankNo) {
                    document.getElementById('bank-info-box').classList.remove('hidden');
                    document.getElementById('no-bank-box').classList.add('hidden');
                    document.getElementById('my-bank-name').innerText = currentData.bankName;
                    document.getElementById('my-bank-no').innerText = `${currentData.bankNo} (${currentData.bankAccName})`;
                } else {
                    document.getElementById('bank-info-box').classList.add('hidden');
                    document.getElementById('no-bank-box').classList.remove('hidden');
                }
            });

            // Transactions (Realtime)
            db.collection('transactions').where('uid','==',currentUser.uid).onSnapshot(snap => {
                allTx = [];
                snap.forEach(doc => allTx.push(doc.data()));
                allTx.sort((a,b) => (b.timestamp?.seconds||0) - (a.timestamp?.seconds||0));
                renderTx('all');
            });
        }

        function renderTx(filter) {
            const list = document.getElementById('tx-list');
            list.innerHTML = '';
            
            const filtered = allTx.filter(t => filter==='all' || t.type===filter);

            if(filtered.length === 0) { list.innerHTML = '<div style="text-align:center; padding:20px; color:#ccc;">‡πÑ‡∏°‡πà‡∏°‡∏µ‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£</div>'; return; }

            filtered.slice(0, 15).forEach(t => {
                let isDep = t.type === 'deposit';
                let color = isDep ? '#10b981' : '#ef4444';
                let sign = isDep ? '+' : '-';
                let icon = isDep ? '<i class="fa-solid fa-arrow-down"></i>' : '<i class="fa-solid fa-arrow-up"></i>';
                let bg = isDep ? '#ecfdf5' : '#fef2f2';
                
                let stClass = t.status==='pending'?'st-pending':(t.status==='approved'?'st-approved':'st-rejected');
                let stText = t.status==='pending'?'‡∏£‡∏≠‡∏≠‡∏ô‡∏∏‡∏°‡∏±‡∏ï‡∏¥':(t.status==='approved'?'‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à':'‡∏ñ‡∏π‡∏Å‡∏õ‡∏è‡∏¥‡πÄ‡∏™‡∏ò');

                list.innerHTML += `
                    <div class="tx-item">
                        <div style="display:flex; align-items:center;">
                            <div class="tx-icon-box" style="background:${bg}; color:${color};">${icon}</div>
                            <div>
                                <div style="font-weight:600; font-size:0.9rem;">${isDep?'‡πÄ‡∏ï‡∏¥‡∏°‡πÄ‡∏á‡∏¥‡∏ô':'‡∏ñ‡∏≠‡∏ô‡πÄ‡∏á‡∏¥‡∏ô'}</div>
                                <div style="font-size:0.75rem; color:#9ca3af;">${t.timestamp ? new Date(t.timestamp.seconds*1000).toLocaleString('th-TH') : '...'}</div>
                            </div>
                        </div>
                        <div style="text-align:right;">
                            <div style="font-weight:700; color:${color};">${sign} ${t.amount.toLocaleString()} ‡∏ø</div>
                            <span class="st-badge ${stClass}">${stText}</span>
                        </div>
                    </div>
                `;
            });
        }

        function filterTx(type, el) {
            document.querySelectorAll('.tab-btn').forEach(b => b.classList.remove('active'));
            el.classList.add('active');
            renderTx(type);
        }

        // --- ACTIONS (SWEETALERT POPUPS) ---

        // 1. BANK INFO
        async function editBankInfo() {
            const { value: formValues } = await Swal.fire({
                title: '‡∏ö‡∏±‡∏ç‡∏ä‡∏µ‡∏ò‡∏ô‡∏≤‡∏Ñ‡∏≤‡∏£‡∏Ç‡∏≠‡∏á‡∏Ñ‡∏∏‡∏ì',
                html:
                    '<input id="swal-bank" class="swal2-input" placeholder="‡∏ä‡∏∑‡πà‡∏≠‡∏ò‡∏ô‡∏≤‡∏Ñ‡∏≤‡∏£ (‡πÄ‡∏ä‡πà‡∏ô ‡∏Å‡∏™‡∏¥‡∏Å‡∏£)" value="'+(currentData.bankName||'')+'">' +
                    '<input id="swal-no" class="swal2-input" placeholder="‡πÄ‡∏•‡∏Ç‡∏ö‡∏±‡∏ç‡∏ä‡∏µ" value="'+(currentData.bankNo||'')+'">' +
                    '<input id="swal-name" class="swal2-input" placeholder="‡∏ä‡∏∑‡πà‡∏≠‡∏ö‡∏±‡∏ç‡∏ä‡∏µ (‡∏†‡∏≤‡∏©‡∏≤‡πÑ‡∏ó‡∏¢)" value="'+(currentData.bankAccName||'')+'">',
                focusConfirm: false,
                showCancelButton: true,
                confirmButtonText: '‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•',
                preConfirm: () => {
                    return [
                        document.getElementById('swal-bank').value,
                        document.getElementById('swal-no').value,
                        document.getElementById('swal-name').value
                    ]
                }
            });

            if (formValues) {
                if(!formValues[0] || !formValues[1] || !formValues[2]) return Swal.fire('‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡∏Å‡∏£‡∏≠‡∏Å‡πÉ‡∏´‡πâ‡∏Ñ‡∏£‡∏ö','','warning');
                await db.collection('users').doc(currentUser.uid).update({
                    bankName: formValues[0],
                    bankNo: formValues[1],
                    bankAccName: formValues[2]
                });
                Swal.fire('‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡πÄ‡∏£‡∏µ‡∏¢‡∏ö‡∏£‡πâ‡∏≠‡∏¢', '', 'success');
            }
        }

        // 2. DEPOSIT
        async function openDeposit() {
            const { value: amt } = await Swal.fire({
                title: '‡πÄ‡∏ï‡∏¥‡∏°‡πÄ‡∏á‡∏¥‡∏ô',
                html: `<div style="background:#f3f4f6; padding:15px; border-radius:10px; margin-bottom:15px; text-align:center;">${ADMIN_BANK_INFO.replace('\n','<br>')}</div>` +
                      `<p style="font-size:0.9rem; color:red;">*‡πÄ‡∏°‡∏∑‡πà‡∏≠‡∏Å‡∏î‡πÅ‡∏à‡πâ‡∏á‡πÄ‡∏ï‡∏¥‡∏° ‡∏£‡∏∞‡∏ö‡∏ö‡∏à‡∏∞‡∏û‡∏≤‡πÑ‡∏õ‡πÅ‡∏ä‡∏ó‡πÄ‡∏û‡∏∑‡πà‡∏≠‡∏™‡πà‡∏á‡∏™‡∏•‡∏¥‡∏õ</p>`,
                input: 'number',
                inputPlaceholder: '‡∏£‡∏∞‡∏ö‡∏∏‡∏à‡∏≥‡∏ô‡∏ß‡∏ô‡πÄ‡∏á‡∏¥‡∏ô',
                showCancelButton: true,
                confirmButtonText: '‡πÅ‡∏à‡πâ‡∏á‡πÄ‡∏ï‡∏¥‡∏°‡πÄ‡∏á‡∏¥‡∏ô'
            });

            if (amt) {
                await db.collection('transactions').add({
                    uid: currentUser.uid, email: currentUser.email, type: 'deposit',
                    amount: parseFloat(amt), status: 'pending', timestamp: firebase.firestore.FieldValue.serverTimestamp()
                });
                
                Swal.fire({
                    icon: 'success', title: '‡πÅ‡∏à‡πâ‡∏á‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£‡πÅ‡∏•‡πâ‡∏ß',
                    text: '‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡∏™‡πà‡∏á‡∏™‡∏•‡∏¥‡∏õ‡πÉ‡∏´‡πâ‡πÅ‡∏≠‡∏î‡∏°‡∏¥‡∏ô‡∏ó‡∏≤‡∏á‡πÅ‡∏ä‡∏ó',
                    confirmButtonText: '‡πÑ‡∏õ‡∏™‡πà‡∏á‡∏™‡∏•‡∏¥‡∏õ', showCancelButton: true
                }).then(r => { if(r.isConfirmed) openFacebook(); });
            }
        }

        // 3. WITHDRAW
        async function openWithdraw() {
            // ‡πÄ‡∏ä‡πá‡∏Ñ‡∏ß‡πà‡∏≤‡∏ú‡∏π‡∏Å‡∏ö‡∏±‡∏ç‡∏ä‡∏µ‡∏¢‡∏±‡∏á
            if(!currentData.bankName || !currentData.bankNo) {
                return Swal.fire({
                    icon: 'warning', title: '‡∏¢‡∏±‡∏á‡πÑ‡∏°‡πà‡∏ú‡∏π‡∏Å‡∏ö‡∏±‡∏ç‡∏ä‡∏µ',
                    text: '‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡πÄ‡∏û‡∏¥‡πà‡∏°‡∏ö‡∏±‡∏ç‡∏ä‡∏µ‡∏ò‡∏ô‡∏≤‡∏Ñ‡∏≤‡∏£‡∏Å‡πà‡∏≠‡∏ô‡∏ñ‡∏≠‡∏ô‡πÄ‡∏á‡∏¥‡∏ô',
                    confirmButtonText: '‡πÄ‡∏û‡∏¥‡πà‡∏°‡∏ö‡∏±‡∏ç‡∏ä‡∏µ'
                }).then(() => editBankInfo());
            }

            const { value: amt } = await Swal.fire({
                title: '‡∏ñ‡∏≠‡∏ô‡πÄ‡∏á‡∏¥‡∏ô',
                html: `<div style="text-align:left; font-size:0.9rem; margin-bottom:10px;">
                        ‡πÇ‡∏≠‡∏ô‡πÄ‡∏Ç‡πâ‡∏≤: <b>${currentData.bankName}</b><br>
                        ‡πÄ‡∏•‡∏Ç‡∏ó‡∏µ‡πà: <b>${currentData.bankNo}</b><br>
                        ‡∏ä‡∏∑‡πà‡∏≠: <b>${currentData.bankAccName}</b>
                       </div>
                       <div style="color:red; font-size:0.8rem; margin-bottom:10px;">*‡∏Ñ‡πà‡∏≤‡∏ò‡∏£‡∏£‡∏°‡πÄ‡∏ô‡∏µ‡∏¢‡∏° 5 ‡∏ö‡∏≤‡∏ó</div>`,
                input: 'number',
                inputPlaceholder: '‡∏£‡∏∞‡∏ö‡∏∏‡∏à‡∏≥‡∏ô‡∏ß‡∏ô‡πÄ‡∏á‡∏¥‡∏ô',
                showCancelButton: true,
                confirmButtonText: '‡∏¢‡∏∑‡∏ô‡∏¢‡∏±‡∏ô‡∏Å‡∏≤‡∏£‡∏ñ‡∏≠‡∏ô'
            });

            if (amt) {
                const amount = parseFloat(amt);
                if((amount + 5) > (currentData.balance || 0)) return Swal.fire('‡πÄ‡∏á‡∏¥‡∏ô‡πÑ‡∏°‡πà‡∏û‡∏≠', '‡∏£‡∏ß‡∏°‡∏Ñ‡πà‡∏≤‡∏ò‡∏£‡∏£‡∏°‡πÄ‡∏ô‡∏µ‡∏¢‡∏°‡πÅ‡∏•‡πâ‡∏ß', 'error');

                await db.collection('transactions').add({
                    uid: currentUser.uid, email: currentUser.email, type: 'withdraw',
                    amount: amount, fee: 5, totalDeduct: amount+5,
                    bankName: currentData.bankName, bankNo: currentData.bankNo, bankAccName: currentData.bankAccName, // ‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏ö‡∏±‡∏ç‡∏ä‡∏µ ‡∏ì ‡∏ï‡∏≠‡∏ô‡∏ñ‡∏≠‡∏ô
                    status: 'pending', timestamp: firebase.firestore.FieldValue.serverTimestamp()
                });
                Swal.fire('‡∏ó‡∏≥‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à', '‡∏£‡∏≠‡πÅ‡∏≠‡∏î‡∏°‡∏¥‡∏ô‡∏≠‡∏ô‡∏∏‡∏°‡∏±‡∏ï‡∏¥', 'success');
            }
        }

        // 4. SUPPORT
        async function openSupport() {
            const { value: text } = await Swal.fire({
                title: '‡∏®‡∏π‡∏ô‡∏¢‡πå‡∏ä‡πà‡∏ß‡∏¢‡πÄ‡∏´‡∏•‡∏∑‡∏≠',
                input: 'textarea',
                inputPlaceholder: '‡∏û‡∏¥‡∏°‡∏û‡πå‡∏Ç‡πâ‡∏≠‡∏Ñ‡∏ß‡∏≤‡∏°‡∏´‡∏≤‡πÅ‡∏≠‡∏î‡∏°‡∏¥‡∏ô...',
                showCancelButton: true,
                confirmButtonText: '‡∏™‡πà‡∏á‡∏Ç‡πâ‡∏≠‡∏Ñ‡∏ß‡∏≤‡∏°'
            });

            if(text) {
                await db.collection('reports').add({
                    uid: currentUser.uid, email: currentUser.email, subject: 'Chat', message: text,
                    status: 'pending', timestamp: firebase.firestore.FieldValue.serverTimestamp()
                });
                Swal.fire('‡∏™‡πà‡∏á‡∏Ç‡πâ‡∏≠‡∏Ñ‡∏ß‡∏≤‡∏°‡πÅ‡∏•‡πâ‡∏ß', '', 'success');
            }
        }

        // 5. SETTINGS
        async function openSettings() {
            const { isConfirmed } = await Swal.fire({
                title: '‡∏Å‡∏≤‡∏£‡∏ï‡∏±‡πâ‡∏á‡∏Ñ‡πà‡∏≤',
                showDenyButton: true,
                showCancelButton: true,
                confirmButtonText: '‡πÅ‡∏Å‡πâ‡πÑ‡∏Ç‡∏ö‡∏±‡∏ç‡∏ä‡∏µ‡∏ò‡∏ô‡∏≤‡∏Ñ‡∏≤‡∏£',
                denyButtonText: '‡∏≠‡∏≠‡∏Å‡∏à‡∏≤‡∏Å‡∏£‡∏∞‡∏ö‡∏ö',
                cancelButtonText: '‡∏õ‡∏¥‡∏î'
            });

            if (isConfirmed) editBankInfo();
            else if (result.isDenied) logout(); // Note: SweetAlert result object handled internally usually but check var name
        }

        // Utils
        function logout() { auth.signOut(); }
        function openFacebook() { window.open(FB_LINK, '_blank'); }
    </script>
</body>
</html>
